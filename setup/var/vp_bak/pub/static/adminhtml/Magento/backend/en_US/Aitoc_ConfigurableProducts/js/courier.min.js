define(['jquery','prototype'],function(jQuery,prototype){var EC_Courier=new Class.create();EC_Courier.prototype={url:null,tries:3,initialize:function(url){this.url=url;},request:function(data){dataArray=data.split("&");if(dataArray.length>2){var valuesArray=new Array();for(i=0;i<dataArray.length;i++){var datawow=dataArray[i].split("=");valuesArray[i]=datawow[1];}
valuesArray.forEach(function(entry){data=data.replace(entry,encodeURIComponent(entry));});}
var _result=this.sendRequest(data);if(true!==_result.status){var txt=ec_translator.say('erroroccured');txt+='\n\n';if(_result.text){txt+=_result.text.replace(/\\n/g,'\n');txt+='\n\n';}
txt+=ec_translator.say('tryagain');if(confirm(txt)){var s=this.tries;while((--s>=0)&&(true!==_result.status)){_result=this.sendRequest(data);}}
else{return false;}
if(true!==_result.status){alert(ec_translator.say('retriesfailed').replace('###',this.tries));return false;}}
return _result;},sendRequest:function(data){var result=new Object();new Ajax.Request(this.url,{method:'post',asynchronous:false,parameters:data,onSuccess:function(response){if(response&&response.responseText){try{response=eval('('+response.responseText+')');}
catch(e){response={};}
if(response.error){result.status=false;result.text=response.error;}
else if(response.success){result.status=true;result.text=response.success;}
else{result.status=false;}}},onFailure:function(){result.status=false;}});return result;}};return EC_Courier;});
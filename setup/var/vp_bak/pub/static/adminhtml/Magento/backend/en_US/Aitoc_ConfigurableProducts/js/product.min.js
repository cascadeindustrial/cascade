define(['jquery','prototype'],function(jQuery,prototype){var EC_Product=new Class.create();EC_Product.prototype={id:null,parameters:null,attributes:null,backup:null,initialize:function(id){this.id=id;this.parameters=$H({});this.attributes=$H({});},load:function(){for(var i=0;i<ec_helper.productParametes.length;i++){var parameter=ec_helper.productParametes[i];this.parameters.set(parameter,$('products['+this.id+']['+parameter+']').value);}
for(i=0;i<ec_helper.productAttributes.length;i++){var attribute=ec_helper.productAttributes[i];var attributeForm=$('form-product-'+this.id+'-attribute-'+attribute);var radioName='product-'+this.id+'-attribute-'+attribute;Form.getInputs(attributeForm,'radio',radioName).each(function(radio){if(radio.checked){this.attributes.set(attribute,radio.value);}}.bind(this));}
this.backup=this.toQueryString();return this;},update:function(){if(this.backup!=this.toQueryString()){for(var i=0;i<ec_helper.productParametes.length;i++){var parameter=ec_helper.productParametes[i];$('products['+this.id+']['+parameter+']').value=this.parameters.get(parameter);}
for(i=0;i<ec_helper.productAttributes.length;i++){var attribute=ec_helper.productAttributes[i];var attributeForm=$('form-product-'+this.id+'-attribute-'+attribute);var radioName='product-'+this.id+'-attribute-'+attribute;var newValue=this.attributes.get(attribute);Form.getInputs(attributeForm,'radio',radioName).each(function(radio){radio.checked=(radio.value==newValue);});}
ec_helper.decorate(this.id);this.setStatus('changed');}
return this;},remove:function(){$('product-column-'+this.id).remove();ec_helper.setHasChanges();},setStatus:function(status){var _status;for(var i=0;i<ec_helper.productStatuses.length;i++){_status=ec_helper.productStatuses[i];if(_status==status){$('product-'+_status+'-'+this.id).show();}
else{$('product-'+_status+'-'+this.id).hide();}}
if('unchanged'!=status){$('products['+this.id+'][is_changed]').value=1;ec_helper.setHasChanges();}
return this;},getStatus:function(){var _status;for(var i=0;i<ec_helper.productStatuses.length;i++){_status=ec_helper.productStatuses[i];if($('product-'+_status+'-'+this.id).getStyle('display')!='none'){return _status;}}
return false;},toQueryString:function(){var s='';for(var i=0;i<ec_helper.productParametes.length;i++){var parameter=ec_helper.productParametes[i];s+='&products['+this.id+']['+parameter+']='+this.parameters.get(parameter);}
for(i=0;i<ec_helper.productAttributes.length;i++){var attribute=ec_helper.productAttributes[i];s+='&products['+this.id+'][attributes]['+attribute+']='+this.attributes.get(attribute);}
return s;},exists:function(){return($('product-column-'+this.id))?true:false;}}
return EC_Product;});
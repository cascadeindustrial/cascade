define(['jquery','prototype','aitconfProduct'],function(jQuery,prototype,EC_Product){var EC_ConfigurationForm=new Class.create();EC_ConfigurationForm.prototype={blockForm:null,form:null,product:null,initialize:function(){this.blockForm=$('product-config-form');this.blockForm.hide();},open:function(id){this.product=new EC_Product(id);this.product.load();this.load();this.blockForm.show();ec_helper.toggleLitebox(true);Event.observe(document,'keypress',this.closeOnEsc.bind(this));return this;},load:function(){var i,field;for(i=0;i<ec_helper.productParametes.length;i++){var parameter=ec_helper.productParametes[i];field=$('product-config['+parameter+']');if('checkbox'==field.type){field.checked=Boolean(Number(this.product.parameters.get(parameter)));toggleValueElements(field,field.up().up(),field.checked)}
else{field.value=this.product.parameters.get(parameter)||'';}}
for(i=0;i<ec_helper.productAttributes.length;i++){var attribute=ec_helper.productAttributes[i];field=$('product-config[attributes]['+attribute+']');field.value=this.product.attributes.get(attribute)||'';}
return this;},close:function(){ec_helper.toggleLitebox(false);this.blockForm.hide();this.clear();Event.stopObserving(document,'keypress',this.closeOnEsc);return true;},closeOnEsc:function(event){if(Event.KEY_ESC==event.keyCode){this.close();}},validate:function(){return true;},apply:function(){if(this.validate()){var i,field;for(i=0;i<ec_helper.productParametes.length;i++){var parameter=ec_helper.productParametes[i];field=$('product-config['+parameter+']');if('checkbox'==field.type){this.product.parameters.set(parameter,Number(field.checked));}
else{this.product.parameters.set(parameter,field.value);}}
for(i=0;i<ec_helper.productAttributes.length;i++){var attribute=ec_helper.productAttributes[i];field=$('product-config[attributes]['+attribute+']');this.product.attributes.set(attribute,field.value);}
this.product.update();this.close();return true;}
return false;},clear:function(){this.blockForm.select('input','select').each(function(field){if('checkbox'==field.type){field.checked=false;toggleValueElements(field,field.up().up(),field.checked)}
else{field.value='';}});}}
return EC_ConfigurationForm;});
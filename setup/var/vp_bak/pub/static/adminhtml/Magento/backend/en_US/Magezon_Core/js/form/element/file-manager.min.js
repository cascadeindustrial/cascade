define(['jquery','ko','Magento_Ui/js/form/element/abstract','mage/translate','Magezon_Core/js/mage/browser'],function($,ko,Element,$t){'use strict';return Element.extend({defaults:{chooseBtnLabel:$t('Select Image'),tmp:null,showPreview:false,fileUrl:'',fileName:'',fileSize:'',previewHeight:'',previewWidth:'',tracks:{showPreview:true,fileUrl:true,fileName:true,fileSize:true,previewHeight:true,previewWidth:true,}},initialize:function(){this._super();if(this.tmp&&this.tmp.name){this.fileSize=this.formatSize(this.tmp.size);this.fileName=this.processFileName(this.tmp.name);this.fileUrl=this.tmp.url;this.showPreview=true;}
return this;},chooseImage:function(){if(!this.disabled()){window.MgzMediabrowserUtility.openDialog(window.mgzFilesBrowserWindowUrl+'target_element_id/'+this.uid+'/',false,false,'Insert Image',{closed:function(){jQuery('#mceModalBlocker').show()}})}
return this;},formatSize:function(bytes){var sizes=['Bytes','KB','MB','GB','TB'],i;if(bytes===0){return'0 Byte';}
i=window.parseInt(Math.floor(Math.log(bytes)/ Math.log(1024)));return Math.round(bytes / Math.pow(1024,i),2)+' '+sizes[i];},removeFile:function(file){if(!this.disabled()){this.showPreview=false;this.value('');}
return this;},onPreviewLoad:function(element,event){var img=event.currentTarget;this.previewWidth=img.naturalWidth;this.previewHeight=img.naturalHeight;},reloadImage:function(element,event){var self=this;var input=event.currentTarget;var file=$(input).val();if(file){this.showPreview=true;this.fileUrl=window.mgzMediaUrl+file;this.fileName=this.processFileName(file);$.ajax({type:'HEAD',url:this.fileUrl,complete:function(xhr){var size=self.formatSize(xhr.getResponseHeader('Content-Length'));if(size){self.fileSize=size;}else{self.fileSize='';}}});}},processFileName:function(name){var nameE=name.split("/");return nameE[nameE.length-1];}});});
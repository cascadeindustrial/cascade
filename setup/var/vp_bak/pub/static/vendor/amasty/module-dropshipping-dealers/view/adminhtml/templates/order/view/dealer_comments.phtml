<?php /** * @author Amasty Team * @copyright Copyright (c) 2020 Amasty (https://www.amasty.com) * @package Amasty_Dropshipping */ ?> <?php /** @var \Amasty\Dropshipping\Block\Adminhtml\Order\View\Tab\Assign $block */ $dealerList = $block->getDealerCollection(); $isAjax = $block->getRequest()->getParam('isAjax'); $orderId = (int)$block->getRequest()->getParam('order_id'); if (!$isAjax): ?> <div style="width: 50%"><div class="order-history-block" id="amasty_perm_order_dealer_comment_history_form"><?php if (!$block->currentDealerId()):?> <div class="admin__field"><label for="amasty_perm_order_dealer_comment_history_dealer" class="admin__field-label"><?= $block->escapeHtml(__('Dealer')) ?></label> <div class="admin__field-control"><select name="amasty_perm_order_dealer_comment_history[dealer]" id="amasty_perm_order_dealer_comment_history_dealer" class="admin__control-select"><?php foreach ($block->getDealers() as $_code => $_label): ?> <option value="<?= (int)$_code ?>"<?php if ($_code == $block->getDealerOrder()->getDealerId()): ?> selected="selected"<?php endif; ?>><?= $block->escapeHtml($_label) ?></option><?php endforeach; ?></select></div></div><?php else: ?> <input name="dealer_id" value="<?= (int)$block->currentDealerId()?>" type="hidden"><?php endif;?> <div class="admin__field"><label for="amasty_perm_order_dealer_history_comment" class="admin__field-label"><?= $block->escapeHtml(__('Comment')) ?></label> <div class="admin__field-control"><textarea name="amasty_perm_order_dealer_comment_history[comment]"
                              rows="3"
                              cols="5"
                              id="amasty_perm_order_dealer_comment_history_comment"
                              class="admin__control-textarea"></textarea></div></div><div class="admin__field"><?php if (!$block->isDealerNotificationNotApplicable()):?> <div class="order-history-comments-options"><div class="admin__field admin__field-option"><input name="amasty_perm_order_dealer_comment_history[is_dealer_notified]" type="checkbox" id="amasty_perm_order_dealer_comment_history_notify" class="admin__control-checkbox" value="1" /><label class="admin__field-label" for="amasty_perm_order_dealer_comment_history_notify"><?= $block->escapeHtml(__('Notify by Email')) ?></label></div></div><?php endif;?> <div class="order-history-comments-actions"><?= $block->getChildHtml('submit_button') ?></div></div></div></div><script type="text/x-magento-init">
    {
        "*": {
            "Magento_Ui/js/core/app": {
                "components": {
                    "diagnostic": {
                        "component": "Amasty_Dropshipping/js/comments",
                        "submitCommentUrl": "<?= $block->escapeUrl($block->getSubmitCommentUrl()); ?>"
                    }
                }
            }
        }
    }</script><?php endif; ?> <div class="amasty_perm_order_dealer_comment_block"><?php foreach ($dealerList as $dealer): ?> <ul class="note-list" name="dealer-history-<?= (int)$dealer->getId() ?>" data-dealer-id="<?= (int)$dealer->getId() ?>"><?php foreach ($block->getAssignedComments((int)$dealer->getId(), $orderId) as $_item): ?> <li class="note-list-item"><span class="note-list-date"><?= $block->escapeHtml($block->formatDate($_item->getCreatedAtDate(), \IntlDateFormatter::MEDIUM)) ?></span> <span class="note-list-time"><?= $block->escapeHtml($block->formatTime($_item->getCreatedAtDate(), \IntlDateFormatter::MEDIUM)) ?></span> <span class="note-list-status"><?= $block->escapeHtml($_item->getAuthorDealerContactname()) ?></span> <span class="note-list-customer"><?php if ($block->isDealerNotificationNotApplicable($_item)): ?> <span class="note-list-customer-notapplicable"><?= $block->escapeHtml(__('Notification Not Applicable')) ?></span> <?php elseif ($_item->getIsDealerNotified()): ?> <span class="note-list-customer-notified"><?= $block->escapeHtml(__('Notified')) ?></span> <?php else: ?> <span class="note-list-customer-not-notified"><?= $block->escapeHtml(__('Not Notified')) ?></span> <?php endif; ?></span> <?php if ($_item->getComment()): ?> <div class="note-list-comment"><?= $block->escapeHtml($_item->getComment(), ['b', 'br', 'strong', 'i', 'u', 'a']) ?></div><?php endif; ?></li> <?php endforeach; ?></ul><?php endforeach; ?></div>
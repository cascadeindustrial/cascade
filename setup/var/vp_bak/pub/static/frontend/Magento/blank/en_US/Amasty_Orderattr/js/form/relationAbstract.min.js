define(['ko','underscore','uiRegistry','Amasty_Orderattr/js/form/relationRegistry'],function(ko,_,registry,relationRegistry){'use strict';return{hidedByRate:false,hidedByDepend:false,relations:{},isRelationsInit:false,onUpdate:function(){this._super();if(this.isRelationsInit){this.checkDependencies();}},initCheck:function(){if(this.relations&&this.relations.length){this.isRelationsInit=true;this.checkDependencies();}},checkDependencies:function(){var listDisplayedUID=[];if(this.relations&&this.relations.length){registry.async(this.parentName)(function(fieldset){this.relations.map(function(relation){registry.async(fieldset.name+'.'+relation.dependent_name)(function(dependElement){if(this.isCanShow(relation)){listDisplayedUID.push(dependElement.uid);this.showDepend(dependElement);}else if(listDisplayedUID.indexOf(dependElement.uid)===-1){this.hideDepend(dependElement);}}.bind(this));}.bind(this));}.bind(this));}},isCanShow:function(relation){if(_.isArray(this.value())){return _.contains(this.value(),relation.option_value)&&this.visible();}
return this.value()===relation.option_value&&this.visible();},showDepend:function(dependElement){relationRegistry.add(dependElement.index,this.index);dependElement.hidedByDepend=false;if(dependElement.hidedByRate){return false;}
dependElement.show();if(_.isFunction(dependElement.checkDependencies)&&dependElement.isRelationsInit){dependElement.checkDependencies();}},hideDepend:function(dependElement){relationRegistry.remove(dependElement.index,this.index);if(!relationRegistry.isExist(dependElement.index)){dependElement.hide();dependElement.hidedByDepend=true;if(_.isFunction(dependElement.checkDependencies)&&dependElement.isRelationsInit){dependElement.checkDependencies();}}}};});
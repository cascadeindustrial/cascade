<?php /** * Copyright (c) 2020. Cart2Quote B.V. All rights reserved. * See COPYING.txt for license details. * @codingStandardsIgnoreFile */ use Magento\Framework\App\Action\Action; ?> <?php $writer = new \Zend\Log\Writer\Stream(BP . '/var/log/price1.log'); $logger = new \Zend\Log\Logger(); $logger->addWriter($writer); /** @var \Cart2Quote\Quotation\Block\Quote\Request\Form\QuoteList $block */ $productCollection = $block->getLoadedProductCollection(); $_helper = $this->helper(Magento\Catalog\Helper\Output::class); $product = $block->getProduct(); $productId = $product->getId(); $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); $storeManager = $objectManager->get('\Magento\Store\Model\StoreManagerInterface'); $stockItem = $objectManager->get('\Magento\CatalogInventory\Api\StockStateInterface'); $stockQty = $stockItem->getStockQty($product->getId(), $product->getStore()->getWebsiteId()); $request = $objectManager->get('Magento\Framework\App\Request\Http'); $param = $request->getParam('product_list_mode'); $logger->info("param"); $logger->info($param); if($stockQty>0){ ?> <div class="proname-sku"><div class="sku-model-brand"><span class="smd"><?php echo "<label>Sku:</label>" ."<i class='smd-val'>".$product->getData('sku')."</i>"; ?></span> <span class="smd"><?php echo "<label>Brand:</label>"."<i class='smd-val'>" .$product->getResource()->getAttribute('brand')->getFrontend()->getValue($product) ."</i>";?></span> <span class="smd-mod-wdt-lst"><?php echo "<label>Model:</label>"."<i class='smd-val-mod-val-lst'>". $product->getData('model_no')."</i>"; ?></span></div></div><?php if ($product->isSaleable() || $block->showQuoteButton()) : ?> <?php $postParams = $block->getParentBlock()->getAddToCartPostParams($product); ?> <form data-role="tocart-form" data-quote-submit-action="<?php echo $block->escapeHtml($block->getAddToQuoteUrl($product)) ?>" data-product-sku="<?php echo $block->escapeHtml($product->getSku()) ?>" action="<?php echo $block->escapeHtml($postParams['action']) ?>" method="post"><input type="hidden" name="product" value="<?php echo $block->escapeHtml($postParams['data']['product']) ?>"><input type="hidden" name="<?php echo $block->escapeHtml(Action::PARAM_NAME_URL_ENCODED) ?>" value="<?php echo $block->escapeHtml($postParams['data'][Action::PARAM_NAME_URL_ENCODED]) ?>"><div class="listview-sec"><?php echo $block->getBlockHtml('formkey') ?> <?php if( $product->getData('type_id') == 'simple' ): ?> <?php if ($product->isSaleable()) : ?> <div class="control qty-block"><span class="input-group__addon"><div onclick="decreaseQty(<?= $block->escapeHtml($product->getId()) ?>)" class="input-groupbutton input-group_button--decrease"><span class="input-group_icon input-group_icon--decrease">-</span></div></span> <input type="number" name="qty" onchange="changeQty(<?= $block->escapeHtml($product->getId()) ?>)"id="qty-<?= $block->escapeHtml($product->getId()) ?>" maxlength="5" class="input-group_input qty" value="1"/><span class="input-group__addon"><div onclick="increaseQty(<?= $block->escapeHtml($product->getId()) ?>)" class="input-groupbutton input-group_button--increase"><span class="input-group_icon input-group_icon--increase">+</span></div></span></div><?php endif; ?> <?php endif; ?> <div class="price-boxes"><div class="home-product-price"><?= /* @noEscape */ $block->getProductPrice($product) ?> <div class="product-special-price"><?php $block->getSpecialPrice($product) ?></div></div><?php $helper = $this->helper('Dcw\CustomPricing\Helper\Data'); $discounValues = $helper->getPercentageCalculation($product); if ($discounValues != '') { $expeditedDiscountPercentage = $discounValues['discount_percentage']; ?> <div class="expedicted-price-discount"><?php $priceHelper = $objectManager->create('Magento\Framework\Pricing\PriceCurrencyInterface'); if ($product->getSpecialPrice()) { $customPrice = $product->getSpecialPrice(); } else { $customPrice = $product->getFinalPrice(); } $logger->info("custom price :".$customPrice); $price = $customPrice - (($customPrice/100)*$expeditedDiscountPercentage); $logger->info("discount price :".$price); $formattedPrice = $priceHelper->convertAndFormat($price); $formattedPrice = $priceHelper->round($price); $formattedPrice = $priceHelper->getCurrencySymbol(); $currencyCode = $storeManager->getStore()->getCurrentCurrencyCode(); $rate = $priceHelper->convert($price, 1, $currencyCode); $logger->info("rate price :".$rate); $customprice = round($rate,2); $customprice = number_format((float)$customprice, 2, '.', ''); $customprice = number_format($customprice,2); $logger->info("total price :".$customprice); echo $formattedPrice.$customprice; ?> <input type="hidden" name="delivery_options" class="delivery_options" value="<?php echo $rate;?>"></div><?php } ?></div></div><?php if( $product->getData('type_id') == 'simple' ): ?> <div class="action-buttons"><button type="submit" data-role="addToCartButton" title="<?php echo $block->escapeHtml(__('Add to Cart')) ?>" class="action tocart primary"><span> <?php echo $block->escapeHtml(__('Add to Cart')) ?></span></button> <?php endif; ?> <?php if( $product->getData('type_id') == 'simple' ): ?> <?php if ($block->showQuoteButton() && !$block->showMessageNotLoggedIn()) : ?> <button type="submit" data-role="addToQuoteButton" title="<?php echo $block->escapeHtml(__('Request Quote')) ?>" class="action primary toquote tocart quote-btn-list"><span> <?php echo $block->escapeHtml(__('Request Quote')) ?></span></button> <?php if($param){ ?> <button type="submit" title="<?php echo $block->escapeHtml(__('QUICK VIEW')) ?>" class="amquickview-hover-list"><span> <?php echo $block->escapeHtml(__('QUICK VIEW')) ?></span></button> <?php } ?> <?php elseif ($block->showMessageNotLoggedIn()) : ?> <button title="<?php echo $block->escapeHtml(__('Request Quote')) ?>" class="action secondary toquote tocart quote-btn-list" disabled="disabled"><span> <?php echo $block->escapeHtml(__('Login to Request Quote22')) ?></span></button></div><?php endif; ?> <?php endif; ?> <?php if( $product->getData('type_id') == 'configurable' ): ?> <div class="action-buttons config-action-btn"><button class="action tocart primary"><a href="<?php echo $product->getProductUrl() ?>" title="Add to Cart" class="action tab-addtocart add-to-cart"><span>View Details</span></a></button> <button class="action primary toquote tocart quote-btn-list"><a href="<?php echo $product->getProductUrl() ?>" title="Request to Quote"><span>Request Quote</span></a></button></div><?php endif; ?></form><?php endif; ?> <?php } else { ?> <div class="list-outof-stock"><div class="proname-sku"><div class="sku-model-brand"><span class="smd"><?php echo "<label>Sku:</label>" ."<i class='smd-val'>".$product->getData('sku')."</i>"; ?></span> <span class="smd"><?php echo "<label>Brand:</label>"."<i class='smd-val'>" .$product->getResource()->getAttribute('brand')->getFrontend()->getValue($product) ."</i>";?></span> <span class="smd-mod-wdt-lst"><?php echo "<label>Model:</label>"."<i class='smd-val-mod-val-lst'>". $product->getData('model_no')."</i>"; ?></span></div></div><?php ?> <div class="listview-sec"><?= /* @noEscape */ $block->getProductPrice($product) ?> <div class="product-special-price"><?php $block->getSpecialPrice($product) ?></div></div><div class="action-buttons config-action-btn outofstock"><button class="action tocart primary"><a href="<?php echo $product->getProductUrl() ?>" title="Add to Cart" class="action tab-addtocart add-to-cart"><span>View Details</span></a></button> <button class="action primary toquote tocart quote-btn-list"><a href="<?php echo $product->getProductUrl() ?>" title="Request to Quote"><span>Request Quote</span></a></button></div><div class = "actions-secondary"><a href="#" data-post='<?php echo $this->helper('Magento\Wishlist\Helper\Data')->getAddParams($product) ?>' class="action towishlist" data-action="add-to-wishlist"></a> <!-- <span>Add To Wishlist</span> --></div></div><?php } ?> <script type="text/x-magento-init">
    {
        "[data-role=tocart-form], .form.map.checkout": {
            "catalogAddToCart": {
                "addToQuoteButtonSelector": "[data-role=addToQuoteButton]",
                "addToCartButtonSelector": "[data-role=addToCartButton]"
            }
        }
    }</script><script>
  function decreaseQty(dataId){
        var qty = jQuery('#qty-'+dataId).val();
        qty = parseInt(qty) -1;
        if(qty < 1){
            qty =1;
        }
        jQuery('#qty-'+dataId).val(qty);
        jQuery('#qtydata-'+dataId).val(qty);
        return false;
}
function increaseQty(dataId){
        var qty = jQuery('#qty-'+dataId).val();
        qty = parseInt(qty) +1;
        jQuery('#qty-'+dataId).val(qty);
        jQuery('#qtydata-'+dataId).val(qty);
        return false;
}
function changeQty(dataId){
        var qty = jQuery('#qty-'+dataId).val();
        if(qty< 1){
            qty = 1;
        }
        jQuery('#qty-'+dataId).val(qty);
        jQuery('#qtydata-'+dataId).val(qty);
        return false;
}</script><script>
    require([
        'jquery',
        'priceBox'
    ], function($){
        $('.expedicted-price-discount').parents('.price-boxes').addClass('active');
        $(".product-item-inner").hover(function(){
        $(this).find('.amquickview-hover-list').remove();
});
    });</script><style type="text/css"> .price-boxes.active .home-product-price{display:none}</style>
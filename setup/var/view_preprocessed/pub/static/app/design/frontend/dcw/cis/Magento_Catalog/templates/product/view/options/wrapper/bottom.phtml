<?php /** * Copyright Â© Magento, Inc. All rights reserved. * See COPYING.txt for license details. */ $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); $resource = $objectManager->get('Magento\Framework\App\ResourceConnection'); $connection = $resource->getConnection(); $helperpath = $objectManager->create('Magento\Catalog\Helper\Data'); $path = $helperpath->getBreadcrumbPath(); unset($path['product']); $catIDS = ''; foreach ($path as $name => $breadcrumb) { $label = $breadcrumb['label']; $query = "SELECT DISTINCT `entity_id` FROM `catalog_category_entity_varchar` WHERE `value` = '$label' and entity_id!=2"; $result = $connection->fetchRow($query); $categoryIds[] = $result['entity_id']; $catIDS = implode(', ',$categoryIds); } ?> <?php $_product = $block->getProduct(); $_productType = $block->getProduct()->getData('type_id'); ?> <?php $stockItem = $_product->getExtensionAttributes()->getStockItem(); ?> <div class="newlayout" name="newlayout"><div class="product-options-bottom"><?= $block->getChildHtml('', true) ?></div><?php if($_productType == 'configurable'){ ?> <div class="downloads_section"><?php $blockObj= $block->getLayout()->createBlock('Amasty\ProductAttachment\Block\Product\AttachmentsTab'); ?> <?php if ($stockItem->getIsInStock()) : ?> <?php if ($files = $blockObj->getAttachments()) : ?> <?php $currentProduct = $objectManager->get('Magento\Framework\Registry')->registry('current_product'); $currentProductId = $currentProduct->getId(); ?> <div class="widget am-attachments am-attachments-<?= $block->escapeHtml($this->getWidgetType()); ?>"><select name="attachment" onchange="getUrlFun(this.value);" id="attachment" class="atc_file"><option value="">Downloads</option><?php foreach ($files as $file) : ?> <?php if($catIDS){ ?> <option value="<?= $this->getBaseUrl().'downloads?productId='.$currentProductId.'&attachment_name='.$block->escapeHtml($file->getLabel()).'&cat_ids='.$catIDS?>" class="am-filelink" target="_blank"><?php }else{ ?> <option value="<?= $this->getBaseUrl().'downloads?productId='.$currentProductId.'&attachment_name='.$block->escapeHtml($file->getLabel())?>" class="am-filelink" target="_blank"><?php } ?> <?= $block->escapeHtml($file->getLabel()); ?></option><?php endforeach; ?></select></div><?php endif; ?> <?php endif; ?> <!-- <div class="addit"> --><!-- AddThis Button BEGIN --><?php if ($stockItem->getIsInStock()) { ?> <h3>Share Product</h3><div class="addthis_toolbox addthis_default_style "><a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_linkedin"></a> <a class="addthis_button_email"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cdd82b5521e49e" async="async"></script><?php } ?></div><?php } ?></div><script>
     function getUrlFun(aurl){
         if(aurl != '') {
             window.open(aurl,'_blank');
         }
     }</script>
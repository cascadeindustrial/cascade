<?php /** * Multishipping checkout shipping template for use with MyShipping * * @var $block \Magento\Multishipping\Block\Checkout\Shipping */ ?> <form action="<?= $block->escapeUrl($block->getPostActionUrl()) ?>" method="post" id="shipping_method_form" class="form multicheckout shipping" data-mage-init='{"validation": {}}' ><?php foreach ($block->getAddresses() as $_index => $_address) : ?> <div class="block block-shipping"><div class="block-title"><strong><?= $block->escapeHtml(__('Address %1 <span>of %2</span>', ($_index+1), $block->getAddressCount()), ['span']) ?></strong></div><div class="block-content"><div class="box box-shipping-address"><strong class="box-title"><span><?= $block->escapeHtml(__('Shipping To')) ?></span> <a href="<?= $block->escapeUrl($block->getAddressEditUrl($_address)) ?>" class="action edit"><span><?= $block->escapeHtml(__('Change')) ?></span></a></strong> <div class="box-content"><address><?= /* @noEscape */ $_address->format('html') ?></address></div></div><div class="box box-shipping-method"><strong class="box-title"><span><?= $block->escapeHtml(__('Shipping Method')) ?></span></strong> <div class="box-content"><?php if (!($_shippingRateGroups = $block->getShippingRates($_address))) : ?> <p><?= $block->escapeHtml(__('Sorry, no quotes are available for this order right now.')) ?></p><?php else : ?> <dl class="items methods-shipping"><?php $_sole = count($_shippingRateGroups) == 1; foreach ($_shippingRateGroups as $code => $_rates) : ?> <dt class="item-title"><?= $block->escapeHtml($block->getCarrierName($code)) ?></dt><dd class="item-content"><fieldset class="fieldset"><legend class="legend"><span><?= $block->escapeHtml($block->getCarrierName($code)) ?></span></legend><br> <?php $_sole = $_sole && count($_rates) == 1; foreach ($_rates as $_rate) : ?> <?php $methodTitle = $_rate->getMethodTitle(); ?> <div class="field choice"><?php if ($_rate->getErrorMessage()) : ?> <strong><?= $block->escapeHtml($_rate->getCarrierTitle()) ?>: <?= $block->escapeHtml($_rate->getErrorMessage()) ?></strong> <?php else : ?> <div class="control"><?php if ($_sole) : ?> <input type="radio" name="shipping_method[<?= (int) $_address->getId() ?>]" value="<?= $block->escapeHtmlAttr($_rate->getCode()) ?>" id="s_method_<?= (int) $_address->getId() ?>_<?= $block->escapeHtmlAttr($_rate->getCode()) ?>" class="radio solo method" checked="checked"/><?php else : ?> <input type="radio" name="shipping_method[<?= (int) $_address->getId() ?>]" value="<?= $block->escapeHtmlAttr($_rate->getCode()) ?>" id="s_method_<?= (int) $_address->getId() ?>_<?= $block->escapeHtmlAttr($_rate->getCode()) ?>" <?= ($_rate->getCode()===$block->getAddressShippingMethod($_address)) ? ' checked="checked"' : '' ?> class="radio method" /><?php endif; ?></div><label for="s_method_<?= (int) $_address->getId() ?>_<?= $block->escapeHtmlAttr($_rate->getCode()) ?>"><?= $block->escapeHtml($methodTitle) ?> <?php $_excl = $block->getShippingPrice($_address, $_rate->getPrice(), $this->helper(Magento\Tax\Helper\Data::class)->displayShippingPriceIncludingTax()); ?> <?php $_incl = $block->getShippingPrice($_address, $_rate->getPrice(), true); ?> <?php if ($this->helper(Magento\Tax\Helper\Data::class)->displayShippingBothPrices() && $_incl != $_excl) : ?> <span class="price-including-tax" data-label="<?= $block->escapeHtmlAttr(__('Incl. Tax')) ?>"><?php endif; ?> <?= $block->escapeHtml($_incl, ['span']) ?> <?php if ($this->helper(Magento\Tax\Helper\Data::class)->displayShippingBothPrices() && $_incl != $_excl) : ?></span> <?php endif; ?> <?php if ($this->helper(Magento\Tax\Helper\Data::class)->displayShippingBothPrices() && $_incl != $_excl) : ?> <span class="price-excluding-tax" data-label="<?= $block->escapeHtmlAttr(__('Excl. Tax')) ?>"><?= $block->escapeHtml($_excl, ['span']) ?></span> <?php endif; ?></label> <?php endif ?> <?php if($code == 'myshipping'): ?> <?php $rateMethod = $_rate->getCarrier() . "_" . $_rate->getMethod(); ?> <div class="myshipping-method" id="myshipping_component_<?= (int) $_address->getId(); ?>"><?php if($_rate->getMethod() == 'new'): ?> <?php $isActive = $rateMethod == $_address->getShippingMethod(); ?> <div class="myshipping-new myshipping-form"><div class="field myshipping-field"><label for="myshipping_new_courier_id_<?= (int) $_address->getId(); ?>"><?= __("Courier"); ?>:</label> <div class="control"><select id="myshipping_new_courier_id_<?= (int) $_address->getId(); ?>" class="myshipping-courier required-entry" name="myshipping_courier_id[<?= (int) $_address->getId(); ?>]"><?php foreach($block->getCourierOptions("Select Courier") as $courier): ?> <?php $_selected = $isActive && $courier['value'] == $_address->getMyshippingCourierId() ? "SELECTED" : ""; ?> <option value="<?= $courier['value']; ?>" <?= $_selected ?>><?= $courier['label']; ?></option><?php endforeach; ?></select></div></div><div class="field myshipping-field"><label for="myshipping_new_account_<?= (int) $_address->getId(); ?>"><?= __("Account"); ?>:</label> <div class="control"><input id="myshipping_new_account_<?= (int) $_address->getId(); ?>" class="myshipping-account required-entry <?php echo $block->getAccountValidationClass(); ?>" type="text" name="myshipping_account[<?= (int) $_address->getId(); ?>]" value="<?= $isActive ? $_address->getMyshippingAccount() : "" ?>" /></div></div><div class="field myshipping-field"><label for="myshipping_new_courier_method_<?= (int) $_address->getId(); ?>"><?= __("Method") ?>:</label> <div class="control"><select id="myshipping_new_courier_method_<?= (int) $_address->getId(); ?>" class="myshipping-courier-method required-entry" name="myshipping_courier_method[<?= (int) $_address->getId(); ?>]"><?php if($courierMethodOptions = $block->getCourierMethodOptions($_address, "Select method")): ?> <?php foreach($courierMethodOptions as $methodOption): ?> <?php $_selected = $isActive && $methodOption['value'] == $_address->getMyshippingCourierMethod() ? "SELECTED" : ""; ?> <option value="<?= $methodOption['value']; ?>" <?= $_selected; ?>><?= $methodOption['label']; ?></option><?php endforeach; ?> <?php endif; ?></select></div></div></div><script type="text/javascript">
                                                                    require([ 'jquery'], function($) {
                                                                        var myshippingComponent = $("#myshipping_component_<?= (int) $_address->getId(); ?> .myshipping-new")[0];
                                                                        var allCourierMethodOptions = <?= json_encode($block->getAllCourierMethodOptions($_address, "Select method")) ?>;

                                                                        $(".myshipping-courier", myshippingComponent).change(function() {
                                                                            var courierId = $(this).val();
                                                                            var courierMethodSelect = $(".myshipping-courier-method", myshippingComponent);
                                                                            courierMethodSelect.html("");

                                                                            $.each(allCourierMethodOptions[courierId], function(methodKey, methodData) {
                                                                                var optionHtml = '<option value="' + methodData['value'] + '">' + methodData['label'] + '</option>';
                                                                                courierMethodSelect.append(optionHtml);
                                                                            });
                                                                        });
                                                                    });</script><?php else: ?> <?php $isActive = $rateMethod == $_address->getShippingMethod(); ?> <?php if($myshippingMethods = $block->getMyshippingMethodsByRate($_address, $_rate)): ?> <div class="myshipping-account myshipping-form"><div class="field myshipping-field"><label for="myshipping_courier_method_<?= (int) $_address->getId() ?>"><?php echo __("Method"); ?>:</label> <div class="control"><select id="myshipping_courier_method_<?= (int) $_address->getId() ?>" name="myshipping_courier_method[<?= (int) $_address->getId() ?>]" class="required-entry"><option value=""><?php echo __("Please select a shipping method"); ?></option><?php foreach($myshippingMethods as $method): ?> <?php $_selected = $isActive && $_address->getMyshippingCourierMethod() == $method['method_code'] ? "SELECTED" : ""; ?> <option value="<?php echo $method['method_code']; ?>" <?php echo $_selected; ?>><?php echo $method['label']; ?></option><?php endforeach; ?></select></div></div></div><?php endif; ?> <?php endif; ?></div><?php endif; ?></div><?php endforeach; ?></fieldset></dd><?php endforeach; ?></dl><?php endif; ?> <?= /* @noEscape */ $block->getItemsBoxTextAfter($_address) ?></div></div><div class="box box-items"><strong class="box-title"><span><?= $block->escapeHtml(__('Items')) ?></span> <a href="<?= $block->escapeUrl($block->getItemsEditUrl($_address)) ?>" class="action edit"><span><?= $block->escapeHtml(__('Edit Items')) ?></span></a></strong> <div class="box-content"><div class="table-wrapper"><table class="items data table" id="shipping-table-<?= (int) $_address->getId() ?>"><caption class="table-caption"><?= $block->escapeHtml(__('Items')) ?></caption><thead><tr><th class="col item" scope="col"><?= $block->escapeHtml(__('Product Name')) ?></th><th class="col qty" scope="col"><?= $block->escapeHtml(__('Qty')) ?></th></tr></thead><tbody><?php foreach ($block->getAddressItems($_address) as $_item) : ?> <tr><td class="col item" data-th="<?= $block->escapeHtmlAttr(__('Product Name')) ?>"><?= $block->getItemHtml($_item->getQuoteItem()) ?></td><td class="col qty" data-th="<?= $block->escapeHtmlAttr(__('Qty')) ?>"><?= $block->escapeHtml($_item->getQty()) ?></td></tr><?php endforeach; ?></tbody></table></div></div></div></div></div><?php endforeach; ?> <?= $block->getChildHtml('checkout_billing_items') ?> <div class="actions-toolbar"><div class="primary"><button class="action primary continue" type="submit"><span><?= $block->escapeHtml(__('Continue to Billing Information')) ?></span></button></div><div class="secondary"><a href="<?= $block->escapeUrl($block->getBackUrl()) ?>" class="action back"><span><?= $block->escapeHtml(__('Back to Select Addresses')) ?></span></a></div></div></form><script type="text/javascript">
    require([ 'jquery', 'mage/mage' ], function($) {
        $(".method").change(function() {
            var parentFieldset = $(this).parents()[2];
            var parentField = $(this).parents()[1];

            $(".myshipping-method", parentFieldset).hide();
            $(".myshipping-method select", parentFieldset).attr("disabled", true);
            $(".myshipping-method input", parentFieldset).attr("disabled", true);
            $(".myshipping-method", parentField).show();
            $(".myshipping-method select", parentField).attr("disabled", false);
            $(".myshipping-method input", parentField).attr("disabled", false);
        });

        $(".myshipping-method").hide();
        $(".myshipping-method select").attr("disabled", true);
        $(".myshipping-method input").attr("disabled", true);

        $(".method").each(function () {
            var checked = $(this).is(":checked");
            if(checked) {
                var parentField = $(this).parents()[1];
                $(".myshipping-method", parentField).show();
                $(".myshipping-method select", parentField).attr("disabled", false);
                $(".myshipping-method input", parentField).attr("disabled", false);
            }
        })
    });</script>
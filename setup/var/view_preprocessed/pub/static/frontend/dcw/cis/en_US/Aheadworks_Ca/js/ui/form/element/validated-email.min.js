define(['jquery','underscore','Magento_Ui/js/form/element/abstract','Aheadworks_Ca/js/action/check-email-availability','Magento_Ui/js/lib/validation/validator',],function($,_,Element,checkEmailAvailability,validator){"use strict";var validateCallback=function(value,params,elementId){return $(elementId).attr('is-email-valid');};validator.addRule('aw-ca-validate-email',validateCallback,$.mage.__('The email is already registered.'));return Element.extend({defaults:{emailType:'',initialValue:'',validateEmailUrl:'',isEmailValid:true,},initialize:function(){this._super();this.validationParams='#'+this.uid;return this;},initObservable:function(){this._super().observe(['isEmailValid']);return this;},emailHasChanged:function(){if(this.valueChangedByUser){if(this.value()!==this.initialValue){this.validateEmail();}else{this.isEmailValid(true);this.validate();}}},validateEmail:function(){var isEmailCheckComplete=$.Deferred(),data={params:{email:this.value(),website_id:this.source.data.website_id?this.source.data.website_id:null,},emailType:this.emailType,validateEmailUrl:this.validateEmailUrl};$("body").trigger('processStart');checkEmailAvailability(isEmailCheckComplete,data);$.when(isEmailCheckComplete).done(function(){this.isEmailValid(true);}.bind(this)).fail(function(){this.isEmailValid(false);}.bind(this)).always(function(){$("body").trigger('processStop');this.validate();}.bind(this));}});});
define(['jquery','Magento_Ui/js/form/form','ko','Magento_Customer/js/model/customer','Magento_Checkout/js/model/shipping-service','Cart2Quote_Quotation/js/quote-checkout/checkout-data-quotation','Cart2Quote_Quotation/js/quote-checkout/model/quote-checkout-model-selector','Cart2Quote_Quotation/js/quote-checkout/model/email-form-usage-observer','uiRegistry'],function($,Component,ko,customer,shippingService,checkoutQuotationData,selector,emailFormUsage,registry){'use strict';return Component.extend({defaults:{template:'Cart2Quote_Quotation/quote-checkout/view/guest-checkout'},loaded:false,loginSelector:'#customer-email-fieldset',isCustomerLoggedIn:customer.isLoggedIn(),showRequestShippingQuote:false,showRequestShippingQuoteTrigger:ko.observable(false),showCreateAccount:ko.observable(false),requestAccount:ko.observable(customer.isLoggedIn()),toggleRequestAccount:function(){this.requestAccount(!this.requestAccount());},checkoutQuotationData:null,initialize:function(){this._super();this.checkoutQuotationData=checkoutQuotationData;registry.async('checkoutProvider')(function(checkoutProvider){var quotationGuestFieldsData=checkoutQuotationData.getQuotationGuestFieldsFromData();if(quotationGuestFieldsData){checkoutProvider.set('quotationGuestFieldData',$.extend({},checkoutProvider.get('quotationGuestFieldData'),quotationGuestFieldsData));}
checkoutProvider.on('quotationGuestFieldData',function(quotationGuestFieldData){checkoutQuotationData.setQuotationGuestFieldsFromData(quotationGuestFieldData);});});},initObservable:function(){this._super();var self=this;this.initShowRequestShippingQuote();if(!this.isCustomerLoggedIn){self.requestAccount.subscribe(function(requestAccount){var reg=requirejs('uiRegistry');var fieldset='checkout.steps.shipping-step.quotation-fields.account-information-fieldsets';if(requestAccount){emailFormUsage.updateFields();reg.get(fieldset+'.'+'dob',function(item){item.enable();var dobSelector='[name="quotationFieldData.dob"] input';if(typeof item.source.quotationFieldData!=='undefined'){item.source.quotationFieldData.dob=$(dobSelector).val();}});reg.get(fieldset+'.'+'gender',function(item){item.enable();var genderSelector='[name="quotationFieldData.gender"] select';if(typeof item.source.quotationFieldData!=='undefined'){item.source.quotationFieldData.gender=$(genderSelector).val();}});}else{emailFormUsage.updateFields();reg.get(fieldset+'.'+'dob',function(item){item.disable();if(typeof item.source.quotationFieldData!=='undefined'){if(typeof item.source.quotationFieldData.dob!=='undefined'){delete item.source.quotationFieldData.dob;}}});reg.get(fieldset+'.'+'gender',function(item){item.disable();if(typeof item.source.quotationFieldData!=='undefined'){if(typeof item.source.quotationFieldData.gender!=='undefined'){delete item.source.quotationFieldData.gender;}}});self.showRequestShippingQuote.evaluateImmediate();}});}
shippingService.isLoading.subscribe(function(isLoading){if(!isLoading&&!this.loaded){this.loaded=true;if(this.isCustomerLoggedIn){emailFormUsage.updateFields();}else{emailFormUsage.updateFields();this.showRequestShippingQuote.evaluateImmediate();}}},this);if(!this.requestAccount()){this.requestAccount(this.allowToUseGuest()===0);}
emailFormUsage.showGuestField.subscribe(function(){var quotationGuestFieldsData=self.checkoutQuotationData.getQuotationGuestFieldsFromData();if(quotationGuestFieldsData){self.checkoutQuotationData.setQuotationGuestFieldsFromData(quotationGuestFieldsData);}
self.showRequestShippingQuote.evaluateImmediate();});this.showRequestShippingQuote.subscribe(function(value){self.showCreateAccount(value&&self.allowToUseGuest()===1);});return this;},allowToUseGuest:function(){return Number(checkoutQuotationData.getQuotationConfigDataFromData().allowGuest);},initShowRequestShippingQuote:function(){var self=this;self.showRequestShippingQuote=ko.computed(function(){var passwordVisible=false,email=false;self.showRequestShippingQuoteTrigger();if(selector.hasLoginModel()){passwordVisible=selector.getLoginModel().isPasswordVisible();email=selector.getLoginModel().validateEmail();}
return!self.isCustomerLoggedIn&&self.allowToUseGuest()>0&&!passwordVisible&&email;});if(typeof self.showRequestShippingQuote.evaluateImmediate!='function'){self.showRequestShippingQuote.evaluateImmediate=function(){if(typeof self.showRequestShippingQuoteTrigger.valueHasMutated==='function'){self.showRequestShippingQuoteTrigger.valueHasMutated();if(typeof self.showRequestShippingQuote.valueHasMutated==='function'){self.showRequestShippingQuote.valueHasMutated();}}else{var randomValue=Math.floor((Math.random()*100)+1);self.showRequestShippingQuoteTrigger(randomValue);}};}
self.showRequestShippingQuote.extend({notify:'always'});}});});
define(['jquery','Magento_Checkout/js/model/quote','Magento_Checkout/js/model/place-order','Cart2Quote_Quotation/js/quote-checkout/action/redirect-on-success','Cart2Quote_Quotation/js/quote-checkout/model/resource-url-manager','mage/translate','Magento_Ui/js/model/messageList','Magento_Checkout/js/model/full-screen-loader','Magento_Customer/js/model/customer','mage/url','Magento_Customer/js/customer-data'],function($,quote,placeOrderService,redirectOnSuccessAction,resourceUrlManagerModel,$t,globalMessageList,fullScreenLoader,customer,url,customerData){'use strict';return function(shippingSameAsBilling,checkoutAsGuest){function handleUndefined(){globalMessageList.addErrorMessage({message:$t('Something went wrong while processing your quote. Please try again later.')});stopLoader();scrollToTop();}
function handleSuccess(quoteId){customerData.invalidate(['quote']);redirectOnSuccessAction.execute(quoteId);}
function handleError(result){if(result.status==401){window.location.replace(url.build('customer/account/login/'));}else{if(result.message!='undefined'){$.each(result.message.split('/n'),function(index,errorMessage){globalMessageList.addErrorMessage({message:errorMessage});});}
stopLoader();scrollToTop();}}
function stopLoader(){fullScreenLoader.stopLoader(true);fullScreenLoader.stopLoader(true);}
function scrollToTop(){$('html, body').animate({scrollTop:$("#checkout").offset().top},500);}
function getQuoteData(){return{cartId:quote.getQuoteId(),form_key:$.mage.cookies.get('form_key'),customer_email:quote.guestEmail==null?customer.customerData.email:quote.guestEmail,shipping_same_as_billing:shippingSameAsBilling,checkout_as_guest:checkoutAsGuest,clear_quote:true};}
function getRequestUrl(){return resourceUrlManagerModel.getUrlForPlaceQuote(quote,getQuoteData());}
return placeOrderService(getRequestUrl(),getQuoteData(),globalMessageList).success(function(result){if(result.error){handleError(result);}else if(result.success){handleSuccess(result.last_quote_id);}else{handleUndefined();}}).fail(function(response){if(response.status==404||response.status==403){location.reload();}});};});
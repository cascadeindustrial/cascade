define(['jquery','Cart2Quote_Quotation/js/quote-checkout/checkout-data-quotation','Cart2Quote_Quotation/js/quote-checkout/minicart-reload','Cart2Quote_Quotation/js/quote-checkout/action/update-quote','Magento_Checkout/js/model/full-screen-loader'],function($,checkoutDataQuotation,minicartReload,updateQuote,fullScreenLoader){"use strict";$.widget('mage.quotationBiddingUpdate',{options:{itemId:0,sessionProductKey:undefined},_create:function(){this.bindInputCheck();this.initInputValue();},bindInputCheck:function(){var self=this;var data=checkoutDataQuotation.getQuotationProductsFromData();var itemId=this.getItemId();$(this.element).keyup(_.debounce(function(e){var dataForm=$('#form-validate');if(dataForm.validation('isValid')){self.updateData();self.saveData();}else if(data.length!==0){$(this).val(data.qty[itemId]);}else{$(this).val(this.getAttribute('value'));}},900));},initInputValue:function(){var data=checkoutDataQuotation.getQuotationProductsFromData();var itemId=this.getItemId();if(typeof data!=='undefined'&&typeof data[this.options.sessionProductKey]!=='undefined'&&typeof data[this.options.sessionProductKey][itemId]!=='undefined'){this.setValue(data[this.options.sessionProductKey][itemId]);}
this.toggleDisabled();},updateData:function(){var data=checkoutDataQuotation.getQuotationProductsFromData(),itemId=this.getItemId(),value=this.getValue();if(data.length==0){data={};}
if(typeof data[this.options.sessionProductKey]==='undefined'){data[this.options.sessionProductKey]={};}
data[this.options.sessionProductKey][itemId]=value;checkoutDataQuotation.setQuotationProductsFromData(data);minicartReload.reload();},saveData:function(){updateQuote(true).done(function(){fullScreenLoader.stopLoader(true);});},getItemId:function(){return this.options.itemId;},getValue:function(){return $(this.element).val();},setValue:function(value){$(this.element).val(value);},toggleDisabled:function(){$(this.element).prop('disabled',function(i,v){return!v;});}});return $.mage.quotationBiddingUpdate;});
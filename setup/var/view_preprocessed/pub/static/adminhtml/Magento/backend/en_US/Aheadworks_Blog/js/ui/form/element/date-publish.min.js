define(['jquery','Magento_Ui/js/form/element/date','moment','mage/translate'],function($,Abstract,moment,$t){'use strict';return Abstract.extend({defaults:{saveAsDraftButton:'[data-ui-id=save-as-draft]',saveAndContinueButton:'[data-ui-id=save-and-continue-button]',updateButton:'[data-ui-id=update-button]',scheduleButton:'[data-ui-id=schedule-button]',publishButton:'[data-ui-id=publish-button]',defaultLabel:$t('Publish now'),publishLabel:$t('Publish at'),scheduleLabel:$t('Schedule for'),imports:{onValueChange:'value'},listens:{'value':'onDateChange'},comparisonPrecision:'minutes',labelPropertyPath:'label'},initObservable:function(){this._super().track(this.labelPropertyPath);return this;},initConfig:function(){this._super();this.allSaveButtons=[this.saveAsDraftButton,this.updateButton,this.scheduleButton,this.publishButton,this.saveAndContinueButton].join(',');return this;},onDateChange:function(value){$(this.allSaveButtons).hide();if(this.isPostAlreadyExists()){$(this.saveAsDraftButton).show();$(this.saveAndContinueButton).show();}
var date=new moment(value);if(date.isValid()){if(this.isNeedToPublishPost(date)){this.updateLabel(this.publishLabel);if(this.isPostAlreadyPublished()){$(this.updateButton).show();}else{$(this.publishButton).show();}}
if(this.isNeedToSchedulePost(date)){this.updateLabel(this.scheduleLabel);if(this.isPostAlreadyScheduled()){$(this.updateButton).show();}else{$(this.scheduleButton).show();}}}else{$(this.publishButton).show();}},isPostAlreadyExists:function(){return this.source.get('data.id');},isNeedToPublishPost:function(date){return(moment().isAfter(date,this.comparisonPrecision)||moment().isSame(date,this.comparisonPrecision));},isNeedToSchedulePost:function(date){return moment().isBefore(date,this.comparisonPrecision);},updateLabel:function(labelValue){this.set(this.labelPropertyPath,labelValue);},isPostAlreadyPublished:function(){return this.source.get('data.is_published');},isPostAlreadyScheduled:function(){return this.source.get('data.is_scheduled');},prepareDateTimeFormats:function(){this._super();if(this.options.showsTime&&this.timezoneFormat){this.validationParams.dateFormat=this.timezoneFormat;}}});});
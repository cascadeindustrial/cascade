define(['jquery','jquery/ui','uiComponent','ko'],function($,ui,Component,ko){'use strict';return Component.extend({defaults:{template:'Cart2Quote_Quotation/quote/section/grid'},sections:ko.observableArray(),sectionsData:null,initialData:null,quoteId:null,actionUrl:null,makeSortable:function(e){$(e).sortable({update:this.sort,opacity:0.7,placeholder:{element:function(currentItem){return $("<tr class=\'placeholder\'><td colspan=\'3\'></td></tr>")[0];},update:function(container,p){}}});},sort:function(){$('#sortable-table').find('tr:not(.deleted) .sort-order').each(function(index,element){ko.dataFor(element).sortOrder(index+1);});},observableField:function(field){this.label=ko.observable(field.label);this.quoteId=ko.observable(field.quote_id);this.sectionId=ko.observable(field.section_id);this.sortOrder=ko.observable(field.sort_order);this.isDeleted=ko.observable(false);},initObservable:function(){this.initFields(this.data);var self=this;if(this.data.sections){this.data.sections.sort(this.sortBySortOrder);this.initialData=ko.observableArray(ko.utils.arrayMap(this.data.sections,function(field){return new self.observableField(field);}));this.sections(this.initialData);}else{this.sections(ko.observableArray([]));}
this.sections().subscribe(this.sort.bind(this));return this;},initFields:function(data){this.quoteId=data.quote_id;this.actionUrl=data.action_url;},sortBySortOrder:function(value1,value2){var sortOrder1=parseInt(value1.sort_order);var sortOrder2=parseInt(value2.sort_order);return((sortOrder1<sortOrder2)?-1:((sortOrder1>sortOrder2)?1:0));},getSections:function(){return this.sections();},addSection:function(){this.getSections().push(new this.observableField({quote_id:this.quoteId}));this.sort();$('#section-form').submit(function(e){e.preventDefault();return false;});},deleteSection:function(section){if(!section.sectionId()){this.getSections().remove(section);}else{section.isDeleted(true);}
this.sort();}});});
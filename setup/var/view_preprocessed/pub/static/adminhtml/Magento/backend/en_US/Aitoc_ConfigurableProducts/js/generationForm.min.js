define(['jquery','prototype'],function(jQuery,prototype){var EC_GenerationForm=new Class.create();EC_GenerationForm.prototype={blockForm:null,blockTip:null,form:null,options:null,initialize:function(){this.options=$H({});this.blockForm=$('generation-form');this.blockTip=$('generation-form-tip');this.blockForm.hide();},open:function(){this.options=$H({});if(this.checkOptionsSelected()){var combinationsNumber=this.getCombinationsNumber();if(!ec_helper.checklimit(combinationsNumber)){alert(ec_translator.say('limitexceeded_generate').replace('###',combinationsNumber));return false;}
this.blockTip.update(ec_translator.say('combinations').replace('###',combinationsNumber.toString()));this.blockForm.show();ec_helper.toggleLitebox(true);Event.observe(document,'keypress',this.closeOnEsc.bind(this));return this;}
return false;},checkOptionsSelected:function(){var i,attribute,values;for(i=0;i<ec_helper.productAttributes.length;i++){attribute=ec_helper.productAttributes[i];values=new Array();ec_helper.blockMain.select('input[id^="generate-'+attribute+'"]').each(function(checkbox){if(checkbox.checked==1){values.push(checkbox.id.replace('generate-'+attribute+'-',''));}});if(values.length==0){alert(ec_translator.say('selectvalues'));return false;}
else{this.options.set(attribute,values);}}
return true;},getCombinationsNumber:function(){var x=1;this.options.each(function(option){x*=option.value.length;});return x;},close:function(){ec_helper.toggleLitebox(false);this.blockForm.hide();this.clear();Event.stopObserving(document,'keypress',this.closeOnEsc);return true;},closeOnEsc:function(event){if(Event.KEY_ESC==event.keyCode){this.close();}},validate:function(){return true;},clear:function(){this.blockForm.select('input','select').each(function(field){field.value='';});this.blockTip.update('');return this;},getCommon:function(){var common=$H({});this.blockForm.select('input','select').each(function(field){common.set(field.id.replace('generation-common-',''),field.value);});return common;},generate:function(){if(this.validate()){var _options=Object.toJSON(this.options);var _common=Object.toJSON(this.getCommon());this.close();ec_helper.ajax_generate(_options,_common);return true;}
return false;}}
return EC_GenerationForm;});
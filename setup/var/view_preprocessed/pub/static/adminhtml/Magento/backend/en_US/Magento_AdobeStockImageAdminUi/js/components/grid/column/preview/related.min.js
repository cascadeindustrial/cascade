define(['uiComponent','underscore','jquery','mage/backend/tabs'],function(Component,_,$){'use strict';return Component.extend({defaults:{template:'Magento_AdobeStockImageAdminUi/grid/column/preview/related',filterChipsProvider:'componentType = filters, ns = ${ $.ns }',tabImagesLimit:4,serieFilterValue:'',modelFilterValue:'',selectedTab:null,relatedImages:{series:{},model:{}},statefull:{serieFilterValue:true,modelFilterValue:true},modules:{chips:'${ $.chipsProvider }',filterChips:'${ $.filterChipsProvider }',preview:'${ $.parentName }.preview'},exports:{serieFilterValue:'${ $.provider }:params.filters.serie_id',modelFilterValue:'${ $.provider }:params.filters.model_id'}},initialize:function(){this._super();this.filterChips().updateActive();return this;},initObservable:function(){this._super().observe(['serieFilterValue','modelFilterValue','selectedTab','relatedImages']);return this;},_isLoaded:function(record){return this.getSeries(record).length||this.getModel(record).length;},_hasData:function(record){return typeof this.relatedImages().series[record.id]!=='undefined'||typeof this.relatedImages().model[record.id]!=='undefined';},isVisible:function(record){return!this._isLoaded(record)||this._hasData(record);},loadRelatedImages:function(record){var series=this.getSeries(record),model=this.getModel(record);if(series&&series.length||model&&model.length){return;}
$.ajax({type:'GET',url:this.preview().relatedImagesUrl,dataType:'json',data:{'image_id':record.id,'limit':this.tabImagesLimit}}).done(function(data){var relatedImages=this.relatedImages();relatedImages.series[record.id]=data.result['same_series'];relatedImages.model[record.id]=data.result['same_model'];this.relatedImages(relatedImages);this.preview().updateHeight();}.bind(this));},getSeries:function(record){return this.relatedImages().series[record.id]||[];},canShowMoreSeriesImages:function(record){return this.getSeries(record).length>=this.tabImagesLimit;},getModel:function(record){return this.relatedImages().model[record.id]||[];},canShowMoreModelImages:function(record){return this.getModel(record).length>=this.tabImagesLimit;},seeMoreFromSeries:function(record){this.serieFilterValue(record.id);this.filterChips().set('applied',{'serie_id':record.id.toString()});},seeMoreFromModel:function(record){this.modelFilterValue(record.id);this.filterChips().set('applied',{'model_id':record.id.toString()});},nextRelated:function(record){var relatedList=this.selectedTab()==='series'?this.getSeries(record):this.getModel(record),nextRelatedIndex=_.findLastIndex(relatedList,{id:this.preview().displayedRecord().id})+1,nextRelated=relatedList[nextRelatedIndex];if(typeof nextRelated==='undefined'){return;}
this.switchImagePreviewToRelatedImage(nextRelated);},prevRelated:function(record){var relatedList=this.selectedTab()==='series'?this.getSeries(record):this.getModel(record),prevRelatedIndex=_.findLastIndex(relatedList,{id:this.preview().displayedRecord().id})-1,prevRelated=relatedList[prevRelatedIndex];if(typeof prevRelated==='undefined'){return;}
this.switchImagePreviewToRelatedImage(prevRelated);},cannotViewPrevious:function(record){var relatedList,prevRelatedIndex,prevRelated;if(!this.selectedTab()){return false;}
relatedList=this.selectedTab()==='series'?this.getSeries(record):this.getModel(record);prevRelatedIndex=_.findLastIndex(relatedList,{id:this.preview().displayedRecord().id})-1;prevRelated=relatedList[prevRelatedIndex];return typeof prevRelated==='undefined';},cannotViewNext:function(record){var relatedList,nextRelatedIndex,nextRelated;if(!this.selectedTab()){return false;}
relatedList=this.selectedTab()==='series'?this.getSeries(record):this.getModel(record);nextRelatedIndex=_.findLastIndex(relatedList,{id:this.preview().displayedRecord().id})+1;nextRelated=relatedList[nextRelatedIndex];return typeof nextRelated==='undefined';},switchImagePreviewToRelatedImage:function(relatedImage){if(!relatedImage){this.selectedTab(null);return;}
if(this.preview().displayedRecord().id===relatedImage.id){return;}
this.preview().showRelated(relatedImage);},switchImagePreviewToSeriesImage:function(record){this.selectedTab('series');this.switchImagePreviewToRelatedImage(record);},switchImagePreviewToModelImage:function(record){this.selectedTab('model');this.switchImagePreviewToRelatedImage(record);}});});
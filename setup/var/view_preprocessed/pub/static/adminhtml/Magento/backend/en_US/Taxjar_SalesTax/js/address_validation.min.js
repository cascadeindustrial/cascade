define(['ko','jquery','uiRegistry','Taxjar_SalesTax/js/modal','Taxjar_SalesTax/js/model/address_validation_core'],function(ko,$,uiRegistry,modal,avCore){'use strict';return function(addressValidation){if(!$('#tj-suggested-addresses').length){return $.mage.addressValidation;}
$.widget('mage.addressValidation',$.mage.addressValidation,{_create:function(){var body=$('body');var button=$(this.options.selectors.button,this.element);var addressModal=$('#tj-suggested-addresses').modal({buttons:[{text:$.mage.__('Edit Address'),class:'',click:function(){this.closeModal();}},{text:$.mage.__('Save Address'),class:'action primary',click:function(){var addrs=avCore.suggestedAddresses();var selectedAddressId=uiRegistry.get('addressValidation').suggestedAddressRadio();var selectedAddress=addrs[selectedAddressId].address;this.data.form.street_1.value=selectedAddress.street;this.data.form.city.value=selectedAddress.city;this.data.form.region_id.value=selectedAddress.regionId;this.data.form.postcode.value=selectedAddress.postcode;this.data.form.country_id.value=selectedAddress.countryId;this.data.form.submit();}}]});this.element.validation({submitHandler:function(form){var addr={street:[form.street_1.value],city:form.city.value,regionId:form.region_id.value,countryId:form.country_id.value,postcode:form.postcode.value};button.attr('disabled',true);body.trigger('processStart');avCore.getSuggestedAddresses(addr,function(res){button.attr('disabled',false);body.trigger('processStop');addressModal.data('mage-modal').openModal({'form':form});},function(res){button.attr('disabled',false);body.trigger('processStop');form.submit();});}});}});return $.mage.addressValidation;};});